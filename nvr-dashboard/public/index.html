<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Zia NVR</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.5/dist/hls.min.js"></script>
<style>
  body{background:#111;color:#eee;font-family:Arial;margin:0;padding:16px}
  .grid{display:flex;gap:12px}
  .cam{background:#222;padding:12px;border-radius:8px;width:480px}
  video{width:100%;border-radius:6px;background:#000}
</style>
</head>
<body>
  <h1>Dashboard</h1>
  <div id="grid" class="grid"></div>
  <script>
    async function loadCams() {
      const res = await fetch('/api/cameras');
      const cams = await res.json();
      const grid = document.getElementById('grid');
      for (const cam of cams) {
        const card = document.createElement('div'); card.className='cam';
        const title = document.createElement('h3'); title.textContent = cam.name;
        const video = document.createElement('video'); video.controls = true; video.autoplay = true; video.muted = true;
        card.appendChild(title); card.appendChild(video);
        grid.appendChild(card);

        // HLS.js playback for browsers
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(cam.hls);
          hls.attachMedia(video);
        } else {
          // native HLS (Safari)
          video.src = cam.hls;
        }
      }
    }
    loadCams();
  </script>
</body>
</html>
